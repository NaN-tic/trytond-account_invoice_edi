INVOIC_D_93A_UN_EAN007
INV|{{invoice.number or invoice.id}}|{{invoice.edi_document_type}}
DTM|{{invoice.invoice_date|replace('-','')}}
PAI|14E
{% if invoice['sales'] -%}
{% for sale in invoice.sales -%}
RFF|ON|{{sale.reference}}
{% endfor -%}
{% else -%}
RFF|ON|{{invoice.reference}}
{% endif -%}
{% for shipment in invoice.shipments -%}
RFF|DQ|{{shipment.reference}}
{% endfor -%}
NADSCO|{{invoice.company.party.edi_operational_point}}|{{invoice.company.party.name}}|{{invoice.company.trade_register}}|{{invoice.company.party.addresses[0].street|replace('\n', '')}}|{{invoice.company.party.addresses[0].city}}|{{invoice.company.party.addresses[0].zip}}|{{invoice.company.party.identifier_code}}
NADBCO|{{invoice.party.edi_operational_point}}|{{invoice.party.name}}|{{invoice.party.addresses[0].street|replace('\n', '')}}|{{invoice.party.addresses[0].city}}|{{invoice.party.addresses[0].zip}}|{{invoice.party.identifier_code}}|{{invoice.party.addresses[0].country.code}}|
NADSU|{{invoice.company.party.edi_operational_point}}|{{invoice.company.party.name}}|{{invoice.company.trade_register}}|{{invoice.company.party.addresses[0].street|replace('\n', '')}}|{{invoice.company.party.addresses[0].city}}|{{invoice.company.party.addresses[0].zip}}|{{invoice.company.party.identifier_code}}|
NADBY|{{invoice.party.edi_operational_point}}|{{invoice.party.name}}|{{invoice.party.addresses[0].street|replace('\n', '')}}|{{invoice.party.addresses[0].city}}|{{invoice.party.addresses[0].zip}}|{{invoice.party.identifier_code}}|
NADII|{{invoice.company.party.edi_operational_point}}|{{invoice.company.party.name}}|{{invoice.company.party.addresses[0].street|replace('\n', '')}}|{{invoice.company.party.addresses[0].city}}|{{invoice.company.party.addresses[0].zip}}|{{invoice.company.party.identifier_code}}|{{invoice.party.addresses[0].country.code}}
NADIV|{{invoice.party.edi_operational_point}}|{{invoice.party.name}}|{{invoice.party.addresses[0].street|replace('\n', '')}}|{{invoice.party.addresses[0].city}}|{{invoice.party.addresses[0].zip}}|{{invoice.party.identifier_code}}
{% if invoice['shipment_address'] -%}
NADDP|{{invoice.shipment_address.edi_ean}}|{{invoice.shipment_address.party.name}}|{{invoice.shipment_address.street|replace('\n', '')}}|{{invoice.shipment_address.city}}|{{invoice.shipment_address.zip}}
{% else -%}
{% set shipment_address = invoice.party.addresses|selectattr('delivery')|first -%}
NADDP|{{shipment_address.edi_ean}}|{{shipment_address.party.name}}|{{shipment_address.street|replace('\n', '')}}|{{shipment_address.city}}|{{shipment_address.zip}}
{% endif -%}
NADPR|{{invoice.party.edi_operational_point}}
NADPE|{{invoice.company.party.edi_operational_point}}
CUX|EUR|4
PAT|35|{{invoice.invoice_date|replace('-','')}}|{{invoice.total_amount}}
{% for line in invoice.lines -%}
LIN|{{line.code_ean13}}|EN|{{loop.index}}
PIALIN|{{line.product.code}}
IMDLIN|{{line.product.name}}|M|F
QTYLIN|47|{{line.quantity|int}}
MOALIN|{{line.amount}}
PRILIN|AAA|0
PRILIN|AAB|{{line.unit_price}}
{% if invoice.shipments|length > 1 -%}
RFFLIN|ON|{{line.sale.reference}}
RFFLIN|DQ|{{line.shipment_reference}}
{% endif -%}
{% if line.discount -%}
ALCLIN|A|1|TD|{{(line.discount * 100)}}
{% endif -%}
{% for tax in line.taxes -%}
TAXLIN|VAT|{{(tax.rate * 100)|int}}|{{(line.amount * tax.rate)|round(2)}}
{% endfor -%}
{% endfor -%}
CNTRES|2|{{ invoice.lines|length }}
MOARES|||{{ invoice.untaxed_amount }}|{{ invoice.total_amount }}|{{
invoice.tax_amount }}
{% for tax in invoice.taxes -%}
TAXRES|VAT|{{ (tax.tax.rate*100)|round(2) }}|{{ tax.amount }}|{{ tax.base }}
{% endfor -%}
